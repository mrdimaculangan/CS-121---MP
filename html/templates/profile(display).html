<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Your Profile</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style_profiledisplay.css') }}">
	<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,200&family=DM+Serif+Display&display=swap" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
</head>
<body>
	<div class="pfp">
		<img src="../static/default_profile.jpg" id="photo">
		<input type="file" id="file" style="display: none;">
	</div>
	<div class="un">
		<p><span id="showuser"></span></p>
	</div>
	<div class="bi-o">
		<p><span id="showbio"></p>
	</div>
	 <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link active" aria-current="page" href="{{ url_for('profile') }}"><i class="bi bi-person"></i> Profile</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('address') }}"><i class="bi bi-house"></i> Address</a>
      </li>
   	  <li class="nav-item">
        <a class="nav-link" href="{{ url_for('shopping_cart') }}"><i class="bi bi-cart"></i> Shopping Cart</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('index') }}"><i class="bi bi-arrow-90deg-left"></i></i> Return to Home</a>
      </li>
    </ul>
    <div class="logo">
    	<img src="../static/logo.png">
    </div><br>
    <div class="main">
    	<h1> My Profile </h1>
    </div>
    <div class="displayname"><p>Name: {{ user_data[0] }}<span id="showname"></span></p></div>
    <div class="displayemail"><p>Email: {{ user_data[1] }}<span id="showemail"></span></p></div>
    <div class="displaybirthday"><p>Date of Birth: {{ user_data[4] }}/{{ user_data[5] }}/{{ user_data[6] }}<span id="showbdate"></span></p></div>
    <div class="displaybio"><p>Bio: {{ user_data[7] }}<span id="showbio"></span></p></div>
    <button type="button" class="btn btn-primary mb-32" id="editButton">
        <a href="{{ url_for('profile_edit') }}">Edit Information</a>
    </button>
    <button type="button" class="btn btn-primary mb-32" id="changePassword">
      <a href="profilev2.html">Change Password</a>
    </button>
    <button type="button" class="btn btn-primary mb-32" id="changePassword" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo">Change Password</button>
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Change Password</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form action="{{ url_for('change_password') }}" method = 'post'>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label">Current Password:</label>
                <input type="password" class="form-control" placeholder="Enter your current password" aria-label="Password" aria-describedby="addon-wrapping" id="myInput" name="current">

                <script>
                  function myFunction() {
                      var x = document.getElementById("myInput");
                      if (x.type === "password") {
                          x.type = "text";
                      } else {
                          x.type = "password";
                      }
                  }
              </script>
              </div>
              <div class="mb-3">
                <label for="message-text" class="col-form-label">New Password:</label>
                <input type="password" class="form-control" placeholder="Enter your new password" aria-label="Password" aria-describedby="addon-wrapping" id="myInput" name="new">
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Password</button>
              </div>
            </form>
            {% if error %}
              <div id="uniqueUsername" class="form-text" style = "color:rgb(244, 120, 120) ">
              Incorrect current password. Please try again!</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <button type="button" class="btn btn-outline-light" id="deleteButton" data-bs-toggle="modal" data-bs-target="#exampleModal2">Delete Account</button>
    <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Are you sure you want to delete your account?</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form action="{{ url_for('delete_account') }}" method="post">
              <div class="mb-3">
                <label for="passfordelete" class="form-label">Enter your password to proceed:</label>
                <input type="password" class="form-control" id="passfordelete" name="passfordelete" required>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" name="confirmdelete">Delete Account</button>
              </div>
            </form>
            {% if error1 %}
                <div id="uniqueUsername" class="form-text" style = "color:rgb(244, 120, 120) ">
                Incorrect password. Please try again!</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

<script>

   document.getElementById('file').addEventListener('change', function() {
    const file = this.files[0];
    const photo = document.getElementById('photo');
    if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            photo.src = event.target.result;
        };
        reader.readAsDataURL(file);
    }
});
      window.addEventListener('load', () => {
        const username = localStorage.getItem('USERNAME');
        const name = localStorage.getItem('NAME');
        const email = localStorage.getItem('EMAIL');
        const number = localStorage.getItem('NUMBER');
        const dayz = localStorage.getItem('DAY');
        const monthz = localStorage.getItem('MONTH');
        const yearz = localStorage.getItem('YEAR');
        const bio = localStorage.getItem('BIO');
        const dateOfBirth = (monthz && dayz && yearz) ? `${monthz} ${dayz}, ${yearz}` : '';

        document.getElementById('showuser').innerHTML = username;
        document.getElementById('showname').innerHTML = name;
        document.getElementById('showemail').innerHTML = email;
        document.getElementById('shownum').innerHTML = number;
        document.getElementById('showbdate').innerHTML = dateOfBirth;
        document.getElementById('showbio').innerHTML = bio;

         const storedImage = localStorage.getItem("USER_IMAGE");
        if (storedImage) {
            document.getElementById('photo').src = storedImage;
        }

    });
</script>

</body>
</html>